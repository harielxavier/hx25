#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Quick validation before push (faster than full build)
echo "ğŸš€ Running pre-push checks..."

# 1. Check if manual chunking is enabled (should be undefined)
if grep -q "manualChunks: (id)" vite.config.ts 2>/dev/null; then
  echo "âŒ CRITICAL: Manual chunking detected in vite.config.ts!"
  echo "Manual chunking causes React initialization errors."
  echo "manualChunks should be set to undefined."
  exit 1
fi

# 2. Check if vite.config.ts has dev-vendor
if grep -q "return 'dev-vendor'" vite.config.ts 2>/dev/null; then
  echo "âŒ CRITICAL: dev-vendor chunk detected in vite.config.ts!"
  echo "This will cause production build failures."
  echo "Remove the dev-vendor chunk before pushing."
  exit 1
fi

# 3. Verify automatic chunking is set
if ! grep -q "manualChunks: undefined" vite.config.ts 2>/dev/null; then
  echo "âš ï¸  WARNING: manualChunks may not be set to undefined"
  echo "Automatic chunking is the safest strategy."
fi

# 4. Check if drop_console is set to true
if grep -q "drop_console: true" vite.config.ts 2>/dev/null; then
  echo "âš ï¸  WARNING: drop_console is set to true"
  echo "This may cause initialization issues with analytics."
  echo "Consider setting to false."
fi

# 5. Check GA4 ID is present in index.html
if ! grep -q "G-SB0Q9ER7KW" index.html 2>/dev/null; then
  echo "âŒ CRITICAL: GA4 tracking ID not found in index.html!"
  exit 1
fi

echo "âœ… Pre-push checks passed!"
